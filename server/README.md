# TCP Server üåê

Python –º–æ–¥—É–ª–∏ –¥–ª—è TCP –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ —Å ESP32 —Ä–æ–±–æ—Ç–æ–º.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
server/
‚îú‚îÄ‚îÄ tcp_send.py            # –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä
‚îú‚îÄ‚îÄ tcp_reciv.py           # –ü—Ä–∏–µ–º –¥–∞–Ω–Ω—ã—Ö –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞
‚îú‚îÄ‚îÄ tcp_send_esp32.py      # –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥ –Ω–∞ ESP32
‚îú‚îÄ‚îÄ ip.py                  # –ü–æ–ª—É—á–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ IP –∞–¥—Ä–µ—Å–∞
‚îú‚îÄ‚îÄ README.md              # –≠—Ç–æ—Ç —Ñ–∞–π–ª
‚îî‚îÄ‚îÄ __pycache__/           # –ö—ç—à Python
```

## üìã –ú–æ–¥—É–ª–∏

### `tcp_send.py`
–ú–æ–¥—É–ª—å –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä.

```python
from server.tcp_send import send_data

# –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Ä–æ–±–æ—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
send_data(HOST, PORT, x_self, y_self, angle_self, x_target, y_target)
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `HOST` - IP –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ (str)
- `PORT` - –ù–æ–º–µ—Ä –ø–æ—Ä—Ç–∞ (int)
- `x_self`, `y_self` - –¢–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è —Ä–æ–±–æ—Ç–∞
- `angle_self` - –¢–µ–∫—É—â–∏–π —É–≥–æ–ª —Ä–æ–±–æ—Ç–∞
- `x_target`, `y_target` - –¶–µ–ª–µ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è
- `delay` - –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –æ—Ç–ø—Ä–∞–≤–∫–∞–º–∏ (default 0.05 —Å–µ–∫)

### `tcp_reciv.py`
–ú–æ–¥—É–ª—å –¥–ª—è –ø—Ä–∏–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞.

```python
from server.tcp_reciv import reciv_data

# –ü—Ä–∏–µ–º –¥–∞–Ω–Ω—ã—Ö –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞
data = reciv_data(HOST, PORT)
```

### `tcp_send_esp32.py`
–ú–æ–¥—É–ª—å –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–º–∞–Ω–¥ –Ω–∞ ESP32.

```python
from server.tcp_send_esp32 import send_to_esp32

# –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã –Ω–∞ ESP32
send_to_esp32(esp32_ip, esp32_port, command)
```

### `ip.py`
–ü–æ–ª—É—á–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ IP –∞–¥—Ä–µ—Å–∞ —Ö–æ—Å—Ç–∞.

```python
from server.ip import now_ip

# –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π IP –∞–¥—Ä–µ—Å
ip = now_ip()
print(f"–¢–µ–∫—É—â–∏–π IP: {ip}")
```

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ TCP —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –ø–æ—Ä—Ç—É 3333

```bash
# –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑—É—è Python –Ω–∞–ø—Ä—è–º—É—é
python -c "
import socket

HOST = '0.0.0.0'  # –°–ª—É—à–∞—Ç—å –Ω–∞ –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö
PORT = 3333

with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
    s.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
    s.bind((HOST, PORT))
    s.listen()
    print(f'–°–µ—Ä–≤–µ—Ä —Å–ª—É—à–∞–µ—Ç –Ω–∞ {HOST}:{PORT}')
    conn, addr = s.accept()
    print(f'–ü–æ–¥–∫–ª—é—á–∏–ª–æ—Å—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: {addr}')
"
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```python
from server.tcp_send import send_data

# –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–∑–∏—Ü–∏–∏ –∏ —Ü–µ–ª–∏
send_data(
    HOST='0.0.0.0',
    PORT=3333,
    x_self=10,
    y_self=20,
    angle_self=45,
    x_target=100,
    y_target=200
)
```

## üîß –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.8+
- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å `socket` (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞)

## üì° –°–µ—Ç–µ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:**
- `HOST` = `0.0.0.0` (—Å–ª—É—à–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö)
- `PORT` = `3333`

**–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
- `HOST` = `127.0.0.1` –∏–ª–∏ `localhost`

**–î–ª—è —Å–µ—Ç–µ–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞:**
- `HOST` = IP –∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ (–ø–æ–ª—É—á–∏—Ç—å —á–µ—Ä–µ–∑ `server.ip.now_ip()`)

## üîå –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö

–î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –±–∏–Ω–∞—Ä–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `struct`:

```python
# –§–æ—Ä–º–∞—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏
struct.pack('fffff', x_self, y_self, angle_self, x_target, y_target)
# 5 float –∑–Ω–∞—á–µ–Ω–∏–π (–ø–æ 4 –±–∞–π—Ç–∞ –∫–∞–∂–¥–æ–µ)
```

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞

```bash
# Windows
netstat -ano | findstr :3333

# Linux/Mac
lsof -i :3333
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```bash
# –ò—Å–ø–æ–ª—å–∑—É—è Python
import socket

sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
result = sock.connect_ex(('192.168.1.143', 3333))

if result == 0:
    print("–ü–æ—Ä—Ç –æ—Ç–∫—Ä—ã—Ç –∏ –¥–æ—Å—Ç—É–ø–µ–Ω")
else:
    print("–ü–æ—Ä—Ç –∑–∞–∫—Ä—ã—Ç –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω")
```

## üìö –°—Å—ã–ª–∫–∏

- [Python socket –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://docs.python.org/3/library/socket.html)
- [Struct —Ñ–æ—Ä–º–∞—Ç](https://docs.python.org/3/library/struct.html)
